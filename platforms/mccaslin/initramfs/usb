# Live USB filesystem mounting			-*- shell-script -*-

mountroot ()
{
    mkdir -p /container
    mkdir -p /squashmnt
    mkdir -p /persistmnt

    mount /dev/sdb /container 2> /dev/null
    while [ ! -e "/container/rootfs.img" ]; do
	/bin/sleep 0.5
	mount /dev/sdb /container 2> /dev/null
    done

    mount -o loop -t squashfs /container/rootfs.img /squashmnt

    if [ -f /container/ext3fs.img ]; then
	mount -o loop /container/ext3fs.img /persistmnt
    else
	mount -t tmpfs none /persistmnt
    fi

    mount -t unionfs -o dirs=/persistmnt=rw:/squashmnt=ro none ${rootmnt}

    if [ -f /container/install.sh ]; then
	 log_begin_msg "Install Process will begin shortly..."
	 exec /container/install.sh
    fi

}
